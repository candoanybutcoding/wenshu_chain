SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
-- Table structure for wensoul_agent_runs
-- ----------------------------
DROP TABLE IF EXISTS `wensoul_agent_runs`;
CREATE TABLE `wensoul_agent_runs` (
  `run_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '工作流运行的唯一ID',
  `user_id` BIGINT NOT NULL COMMENT '发起运行的用户ID',
  `agent_id` BIGINT NOT NULL COMMENT '正在运行的智能体ID',
  `status` VARCHAR(20) NOT NULL DEFAULT 'running' COMMENT '运行状态 (如: running, paused, completed, failed)',
  `current_node_id` VARCHAR(100) DEFAULT NULL COMMENT '当前激活或最后完成的节点ID',
  `node_results` JSON DEFAULT NULL COMMENT '存储每个已完成节点输入和输出的JSON对象',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`run_id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_agent_id` (`agent_id`),
  KEY `idx_status` (`status`),
  CONSTRAINT `fk_agent_run_user` FOREIGN KEY (`user_id`) REFERENCES `wensoul_user` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_agent_run_agent` FOREIGN KEY (`agent_id`) REFERENCES `wensoul_agent` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用于追踪Agent工作流的运行实例和状态';asdasd

SET FOREIGN_KEY_CHECKS = 1;

-- 插入额外两个智能体的模拟数据

-- 模拟数据 1: 小说章节大纲生成器 (一个多步骤的纯文本工作流)
INSERT INTO `wensoul_agent` (`agent_name`, `agent_description`, `workflow`) VALUES
('小说章节大纲生成器', '根据小说核心设定，生成详细的章节大纲，包括起因、经过、高潮和结局。', '[
  {
    "nodeId": "step1_brainstorm_events",
    "nodeName": "头脑风暴关键事件",
    "nodeType": "text-to-text",
    "model": "gpt-4o",
    "promptTemplate": "我的小说章节核心想法是：【{{input}}】。请为此生成5个可能的关键转折事件或情节冲突点。"
  },
  {
    "nodeId": "step2_structure_outline",
    "nodeName": "构建章节结构",
    "nodeType": "text-to-text",
    "model": "gpt-4-turbo",
    "promptTemplate": "根据以下筛选后的关键事件【{{input}}】，请构建一个包含“开端”、“发展”、“高潮”和“结局”的完整章节大纲。"
  },
  {
    "nodeId": "step3_expand_details",
    "nodeName": "扩写情节详述",
    "nodeType": "text-to-text",
    "model": "gpt-4-turbo",
    "promptTemplate": "请将以下章节大纲的每一个部分进行扩写，增加更多细节描述和人物心理活动：\n\n{{input}}"
  }
]');

-- 模拟数据 2: IP全网声量分析 (一个包含工具调用和文本分析的混合工作流)
INSERT INTO `wensoul_agent` (`agent_name`, `agent_description`, `workflow`) VALUES
('IP全网声量分析', '输入IP名称，自动整合全网公开数据，分析其声量、情感倾向和热门讨论话题。', '[
  {
    "nodeId": "step1_web_search",
    "nodeName": "聚合网络数据",
    "nodeType": "tool-web-search",
    "model": "internal-search-engine",
    "promptTemplate": "{{input}}"
  },
  {
    "nodeId": "step2_analyze_sentiment",
    "nodeName": "总结与情感分析",
    "nodeType": "text-to-text",
    "model": "gpt-4-turbo",
    "promptTemplate": "根据以下从网络上聚合的数据，请总结关于“{{input}}”的整体舆论声量、正面与负面情感倾向，并列出最热门的三个讨论话题：\n\n{{raw_search_results}}"
  }
]');